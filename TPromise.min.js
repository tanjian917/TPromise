(function(c){function TPromise(b){let _this=this;this._cbs=[];this._result=null;this.status='pending';function resolve(a){_this._result={type:0,a};_this.status='resolved';_this.__dispatchCb.call(_this)}function reject(a){_this._result={type:1,a};_this.status='reject';_this.__dispatchCb.call(_this)}setTimeout(function(){try{b.apply(_this,[resolve,reject])}catch(err){reject(err)}},0);return this}TPromise.prototype._TYPE_THEN=0;TPromise.prototype._TYPE_CATCH=1;TPromise.prototype._TYPE_FINALLY=2;TPromise.prototype.__dispatchCb=function(){let{type,data}=this._result,sThen=(type==0),_cbs=this._cbs;while(_cbs.length){let cbItem=_cbs.splice(0,1)[0],statuType=cbItem.type;if(sThen&&statuType===this._TYPE_THEN){data=cbItem.cb(data);this._result.data=data}else if(!sThen&&statuType===this._TYPE_CATCH){data=cbItem.cb(data);this._result.data=data}else if(cbItem.type===this._TYPE_FINALLY){cbItem.cb()}if(!sThen)sThen=(cbItem.type==1)}}TPromise.prototype.then=function(a,b){if((typeof a)==='function')this._cbs.push({type:this._TYPE_THEN,cb:a});if((typeof b)==='function')this.catch(b);if(this._result)this.__dispatchCb(this._TYPE_THEN);return this}TPromise.prototype.catch=function(a){if((typeof a)==='function')this._cbs.push({type:this._TYPE_CATCH,cb:a});if(this._result)this.__dispatchCb(this._TYPE_CATCH);return this}TPromise.prototype.finally=function(a){if((typeof a)==='function')this._cbs.push({type:this._TYPE_FINALLY,cb:a});if(this._result)this.__dispatchCb(this._TYPE_FINALLY);return this};TPromise.resolve=function(a){return new TPromise((resolve,reject)=>{resolve(a)})}TPromise.reject=function(a){return new TPromise((resolve,reject)=>{reject(a)})}TPromise.race=function(b){let filterPromises=[];let formataPromise=function(a){if(!(a instanceof TPromise)&&!(a instanceof Promise))return TPromise.resolve(a);return a}if(b instanceof Array){for(let i=0,len=b.length;i<len;i++){filterPromises.push(formataPromise(b[i]))}}else filterPromises.push(formataPromise(b));let hasThen=true;return new Promise((resolve,reject)=>{let eIndex=filterPromises.length;for(let i=0;i<eIndex;i++){let promise=filterPromises[i];promise.then(result=>{if(hasThen){hasThen=false;resolve(result)}})}})}TPromise.all=function(b){let filterPromises=[];let formataPromise=function(a){if(!(a instanceof TPromise))return TPromise.resolve(a);return a}if(b instanceof Array){for(let i=0,len=b.length;i<len;i++){filterPromises.push(formataPromise(b[i]))}}else filterPromises.push(formataPromise(b));return new TPromise((resolve,reject)=>{let isResolve=true,results=[],eIndex=filterPromises.length;let iteratorPromise=function(a){if(a>=eIndex){if(isResolve)resolve(results);else reject(results);return}let promise=filterPromises[a];promise.then(result=>{results.push(result);return result}).catch(err=>{results.push(err);isResolve=false;return err}).finally(()=>{a++;iteratorPromise(a)})}iteratorPromise(0)})}c.TPromise=TPromise})(global||window);